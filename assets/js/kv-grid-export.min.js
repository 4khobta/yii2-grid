/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2013
 * @version 1.0.0
 *
 * Grid Export Validation Module for Yii's Gridview. Supports export of
 * grid data as CSV, HTML, or Excel.
 *
 * Author: Kartik Visweswaran
 * Copyright: 2013, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */(function(e){var t=function(t,n){this.$element=e(t);this.$grid=n.grid;this.$table=this.$grid.find("table");this.filename=n.filename;this.showHeader=n.showHeader;this.columns=n.showHeader?"td,th":"td";this.htmlTemplate=n.htmlTemplate;this.hasDownloadSupport="download"in document.createElement("a");this.message=n.message;this.listen()};t.prototype={constructor:t,listen:function(){var e=this;if(e.$element.hasClass("export-csv")){e.$element.on("click",function(t){if(e.message&&e.message.length){alert(e.message)}e.exportCSV();if(!e.hasDownloadSupport){t.preventDefault()}})}else if(e.$element.hasClass("export-html")){e.$element.on("click",function(t){if(e.message&&e.message.length){alert(e.message)}e.exportHTML();if(!e.hasDownloadSupport){t.preventDefault()}})}},exportHTML:function(){var t=this,n=t.$table;n.find("tr.filters").remove();n.find("th").removeAttr("rowspan");var r=e("<div />").html(n.clone()).html(),r="data:x-application/text;charset=utf-8,"+encodeURIComponent(t.htmlTemplate.replace("{data}",r));if(t.hasDownloadSupport){t.$element.attr({download:t.filename+".htm",href:r,target:"_blank"})}else{window.open(r)}},exportCSV:function(){var t=this,n=t.$table.find("tr:has("+t.columns+")");var r=String.fromCharCode(11),i=String.fromCharCode(0);var s='","',o='"\r\n"';var u='"'+n.map(function(n,i){var s=e(i),o=s.find(t.columns);return o.map(function(t,n){var r=e(n),i=r.text();return i.replace('"','""')}).get().join(r)}).get().join(i).split(i).join(o).split(r).join(s)+'"';var a="data:application/csv;charset=utf-8,"+encodeURIComponent(u);if(t.hasDownloadSupport){t.$element.attr({download:t.filename,href:a,target:"_blank"})}else{window.open(a)}}};e.fn.gridexport=function(n){return this.each(function(){var r=e(this),i=r.data("gridexport");if(!i){r.data("gridexport",i=new t(this,n))}if(typeof n=="string"){i[n]()}})};e.fn.gridexport=function(n){var r=Array.apply(null,arguments);r.shift();return this.each(function(){var i=e(this),s=i.data("gridexport"),o=typeof n==="object"&&n;if(!s){i.data("gridexport",s=new t(this,e.extend({},e.fn.gridexport.defaults,o,e(this).data())))}if(typeof n==="string"){s[n].apply(s,r)}})};e.fn.gridexport.defaults={filename:"export",showHeader:true,htmlTemplate:"",hasDownloadSupport:true,message:""}})(window.jQuery)