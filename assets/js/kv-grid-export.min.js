/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2013
 * @version 1.0.0
 *
 * Grid Export Validation Module for Yii's Gridview. Supports export of
 * grid data as CSV, HTML, or Excel.
 *
 * Author: Kartik Visweswaran
 * Copyright: 2013, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */(function(e){var t=function(t,n){this.$element=e(t);this.$grid=n.grid;this.$table=this.$grid.find("table");this.$form=this.$grid.find("form.kv-export-form");this.filename=n.filename;this.showHeader=n.showHeader;this.columns=n.showHeader?"td,th":"td";this.htmlTemplate=n.htmlTemplate;this.worksheet=n.worksheet;this.message=n.message;this.listen()};t.prototype={constructor:t,listen:function(){var e=this;if(e.$element.hasClass("export-csv")){e.$element.on("click",function(t){if(e.message&&e.message.length){alert(e.message)}e.exportCSV();t.preventDefault()})}else if(e.$element.hasClass("export-html")){e.$element.on("click",function(t){if(e.message&&e.message.length){alert(e.message)}e.exportHTML();t.preventDefault()})}else if(e.$element.hasClass("export-xls")){e.$element.on("click",function(t){if(e.message&&e.message.length){alert(e.message)}e.exportEXCEL();t.preventDefault()})}},clean:function(){var e=this,t=e.$table;t.find("tr.filters").remove();t.find("th").removeAttr("rowspan");if(!e.showHeader){t.find("thead").remove()}if(!e.showPageSummary){t.find("tfoot.kv-page-summary").remove()}if(!e.showFooter){t.find("tfoot.kv-table-footer").remove()}if(!e.showCaption){t.find("kv-table-caption").remove()}return t},download:function(e,t){var n=this;n.$form.find('[name="export_filetype"]').val(e);n.$form.find('[name="export_filename"]').val(n.filename);n.$form.find('[name="export_content"]').val(t);n.$form.submit()},exportHTML:function(){var t=this,n=t.clean();var r=t.htmlTemplate.replace("{data}",e("<div />").html(n.clone()).html());t.download("html",r)},exportCSV:function(){var t=this,n=t.clean(),r=n.find("tr:has("+t.columns+")");var i=String.fromCharCode(11),s=String.fromCharCode(0);var o='","',u='"\r\n"';var a='"'+r.map(function(n,r){var s=e(r),o=s.find(t.columns);return o.map(function(t,n){var r=e(n),i=r.text();return i.replace('"','""')}).get().join(i)}).get().join(s).split(s).join(u).split(i).join(o)+'"';t.download("csv",a)},exportEXCEL:function(){var t=this,n=t.clean();var r=e("<div />").html(n.clone()).html();r=t.htmlTemplate.replace("{worksheet}",t.worksheet).replace("{data}",r);r=r.replace(/"/g,"'");t.download("xls",r)}};e.fn.gridexport=function(n){return this.each(function(){var r=e(this),i=r.data("gridexport");if(!i){r.data("gridexport",i=new t(this,n))}if(typeof n=="string"){i[n]()}})};e.fn.gridexport=function(n){var r=Array.apply(null,arguments);r.shift();return this.each(function(){var i=e(this),s=i.data("gridexport"),o=typeof n==="object"&&n;if(!s){i.data("gridexport",s=new t(this,e.extend({},e.fn.gridexport.defaults,o,e(this).data())))}if(typeof n==="string"){s[n].apply(s,r)}})};e.fn.gridexport.defaults={filename:"export",showHeader:true,showPageSummary:true,showFooter:true,showCaption:true,htmlTemplate:"",worksheet:"",hasDownloadSupport:true,message:""}})(window.jQuery)