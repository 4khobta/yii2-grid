/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version   3.0.2
 *
 * Client actions for yii2-grid expand row
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvRowNum=0,kvExpandRow;kvExpandRow=function(e){"use strict";!function(n){var t=e.gridId,a=e.hiddenFromExport,l=e.detailUrl,o=e.onDetailLoaded,d=e.batchToggle,i=e.expandIcon,s=e.collapseIcon,r=e.expandTitle,c=e.collapseTitle,v=e.expandAllTitle,p=e.collapseAllTitle,f=e.expandOneOnly,k=e.enableRowClick,u=e.rowClickExcludedTags,x=e.enableCache,w=e.extraData,h=a?e.rowCssClass+" skip-export":e.rowCssClass,g=e.animationDuration,m=n("#"+t),C=m.find(".kv-expand-header-cell"),R=C.find(".kv-expand-header-icon"),A=void 0===e.collapseAll?!1:e.collapseAll,N=void 0===e.expandAll?!1:e.expandAll,b=m.find("td .kv-expand-row:not(.kv-state-disabled)"),y=b.length,T="kv-expand-detail-loading",E=function(){var e=m.find(".kv-expand-icon:first").closest("tr"),t=0;return e.length?(e=e.clone(),e.find(".kv-expand-row").remove(),e.find("td").each(function(){"none"!==n(this).css("display")&&t++}),t):0},D=E(),I=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},F=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},L=function(e,n){e.removeClass(n).addClass(n)},O=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},U=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},j=function(e){L(e,T)},K=function(e){var n=isNaN(g)?1e3:g+200;setTimeout(function(){e.removeClass(T)},n)};return 0===w.length&&(w={}),0===b.length?void L(C,"kv-state-disabled"):(b.each(function(){var t,a,v=n(this),p=v.find(".kv-expand-icon"),E=v.closest("tr"),L=v.closest(".kv-expand-icon-cell"),Q=v.find(".kv-expand-detail"),q=v.find(".kv-expanded-row"),z=q.data("key"),B=q.data("index");if(!I(p)&&!F(p))return!0;0===q.length&&(z=E.data("key"),t=E.next('tr.kv-expand-detail-row[data-key="'+z+'"]'),q=t.find(".kv-expanded-row"));var G=function(e){var t=n.extend({expandRowKey:z,expandRowInd:B},w),a=x?0===q.html().length:!0;return j(L),l.length>0&&a?(m.trigger("kvexprow.beforeLoad",[B,z,w]),void q.load(l,t,function(){K(L),o&&n.isFunction(o)&&o(),e(),m.trigger("kvexprow.loaded",[B,z,w])})):(K(L),void e())},H=function(e){m.find('tr[data-index="'+B+'"]').remove(),q.hide(),E.after(q);var n='<tr class="kv-expand-detail-row '+h+'" data-key="'+z+'" data-index="'+B+'">';q.wrap('<td colspan="'+D+'">').parent().wrap(n),p.html(s),L.attr("title",c),e?q.slideDown(g,function(){U(p)}):(q.show(),U(p)),0===l.length&&K(L)},J=function(){j(L),Q.html(""),p.html(i),L.attr("title",r),a=q.closest(".kv-expand-detail-row"),q.slideUp(g,function(){q.unwrap().unwrap(),q.appendTo(Q),O(p)}),K(L)},M=function(){var t,a,l=!1,o=!1;if(!L.hasClass(T)){if(F(p)){if(a=f&&!A){if(t=n.extend({},e,{collapseAll:!0}),b.each(function(){return n(this).closest(".kv-expand-icon-cell").hasClass(T)?void(o=!0):void 0}),o)return;kvExpandRow(t),l=!0}return G(function(){H(!0)}),void((!a||l)&&(m.trigger("kvexprow.toggle",[B,z,w,!0]),p.focus()))}I(p)&&(J(),m.trigger("kvexprow.toggle",[B,z,w,!1]),p.focus())}};return N&&d?(F(p)&&G(function(){H(!0),kvRowNum++,kvRowNum>=y&&(K(C),R.focus())}),kvRowNum>=y&&(K(C),R.focus()),!0):A&&d?(I(p)&&(J(),kvRowNum++,kvRowNum>=y&&(K(C),R.focus())),kvRowNum>=y&&(K(C),R.focus()),!0):(I(p)&&H(!1),L.off("click").on("click",function(){M(L)}),void E.off("click").on("click",function(e){var t=e.target,a=n(t).length&&n(t).hasClass("kv-disable-click")||-1!==n.inArray(t.nodeName,u);k&&!a&&M(L)}))}),void(d&&C.off().on("click",function(){if(!C.hasClass(T)&&0!==b.length){var t=F(R),a=I(R),l=n.extend({},e,{expandAll:a,collapseAll:t});j(C),a?(kvRowNum=b.find(".kv-state-collapsed").length,O(R),R.html(s),C.attr("title",p),m.trigger("kvexprow.toggleAll",[w,!1])):t&&(kvRowNum=b.find(".kv-state-expanded").length,U(R),R.html(i),C.attr("title",v),m.trigger("kvexprow.toggleAll",[w,!0])),kvExpandRow(l)}})))}(window.jQuery)};