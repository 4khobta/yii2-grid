/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version   3.0.1
 *
 * Client actions for yii2-grid expand row
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvRowNum=0,kvExpandRow;kvExpandRow=function(e){"use strict";!function(a){var t=e.gridId,n=e.hiddenFromExport,l=e.detailUrl,o=e.onDetailLoaded,d=e.batchToggle,i=e.expandIcon,s=e.collapseIcon,r=e.expandTitle,c=e.collapseTitle,v=e.expandAllTitle,p=e.collapseAllTitle,k=e.expandOneOnly,u=e.enableRowClick,f=e.rowClickExcludedTags,x=e.enableCache,w=e.extraData,g=n?e.rowCssClass+" skip-export":e.rowCssClass,h=e.animationDuration,m=a("#"+t),C=m.find(".kv-expand-header-cell"),R=C.find(".kv-expand-header-icon"),A=void 0===e.collapseAll?!1:e.collapseAll,N=void 0===e.expandAll?!1:e.expandAll,b=m.find("td .kv-expand-row:not(.kv-state-disabled)"),y=b.length,T="kv-expand-detail-loading",E=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},D=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},I=function(e,a){e.removeClass(a).addClass(a)},F=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},L=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},O=function(e){I(e,T)},U=function(e){var a=isNaN(h)?1e3:h+200;setTimeout(function(){e.removeClass(T)},a)};return 0===w.length&&(w={}),0===b.length?void I(C,"kv-state-disabled"):(b.each(function(){var t,n,v=a(this),p=v.find(".kv-expand-icon"),I=v.closest("tr"),j=v.closest(".kv-expand-icon-cell"),K=v.find(".kv-expand-detail"),Q=v.find(".kv-expanded-row"),q=Q.data("key"),z=Q.data("index"),B=I.find("td:visible").length;if(!E(p)&&!D(p))return!0;0===Q.length&&(q=I.data("key"),t=I.next('tr.kv-expand-detail-row[data-key="'+q+'"]'),Q=t.find(".kv-expanded-row"));var G=function(e){var t=a.extend({expandRowKey:q,expandRowInd:z},w),n=x?0===Q.html().length:!0;return O(j),l.length>0&&n?(m.trigger("kvexprow.beforeLoad",[z,q,w]),void Q.load(l,t,function(){U(j),o&&a.isFunction(o)&&o(),e(),m.trigger("kvexprow.loaded",[z,q,w])})):(U(j),void e())},H=function(e){m.find('tr[data-index="'+z+'"]').remove(),Q.hide(),I.after(Q);var a='<tr class="kv-expand-detail-row '+g+'" data-key="'+q+'" data-index="'+z+'">';Q.wrap('<td colspan="'+B+'">').parent().wrap(a),p.html(s),j.attr("title",c),e?Q.slideDown(h,function(){L(p)}):(Q.show(),L(p)),0===l.length&&U(j)},J=function(){O(j),K.html(""),p.html(i),j.attr("title",r),n=Q.closest(".kv-expand-detail-row"),Q.slideUp(h,function(){Q.unwrap().unwrap(),Q.appendTo(K),F(p)}),U(j)},M=function(){var t,n,l=!1,o=!1;if(!j.hasClass(T)){if(D(p)){if(n=k&&!A){if(t=a.extend({},e,{collapseAll:!0}),b.each(function(){return a(this).closest(".kv-expand-icon-cell").hasClass(T)?void(o=!0):void 0}),o)return;kvExpandRow(t),l=!0}return G(function(){H(!0)}),void((!n||l)&&(m.trigger("kvexprow.toggle",[z,q,w,!0]),p.focus()))}E(p)&&(J(),m.trigger("kvexprow.toggle",[z,q,w,!1]),p.focus())}};return N&&d?(D(p)&&G(function(){H(!0),kvRowNum++,kvRowNum>=y&&(U(C),R.focus())}),kvRowNum>=y&&(U(C),R.focus()),!0):A&&d?(E(p)&&(J(),kvRowNum++,kvRowNum>=y&&(U(C),R.focus())),kvRowNum>=y&&(U(C),R.focus()),!0):(E(p)&&H(!1),j.off("click").on("click",function(){M(j)}),void I.off("click").on("click",function(e){var t=e.target,n=a(t).length&&a(t).hasClass("kv-disable-click")||-1!==a.inArray(t.nodeName,f);u&&!n&&M(j)}))}),void(d&&C.off().on("click",function(){if(!C.hasClass(T)&&0!==b.length){var t=D(R),n=E(R),l=a.extend({},e,{expandAll:n,collapseAll:t});O(C),n?(kvRowNum=b.find(".kv-state-collapsed").length,F(R),R.html(s),C.attr("title",p),m.trigger("kvexprow.toggleAll",[w,!1])):t&&(kvRowNum=b.find(".kv-state-expanded").length,L(R),R.html(i),C.attr("title",v),m.trigger("kvexprow.toggleAll",[w,!0])),kvExpandRow(l)}})))}(window.jQuery)};