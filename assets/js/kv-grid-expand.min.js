/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version   3.0.1
 *
 * Client actions for yii2-grid expand row
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvRowNum=0,kvExpandRow;kvExpandRow=function(e){"use strict";!function(t){var a=e.gridId,n=e.hiddenFromExport,l=e.detailUrl,o=e.onDetailLoaded,d=e.batchToggle,i=e.expandIcon,s=e.collapseIcon,r=e.expandTitle,c=e.collapseTitle,v=e.expandAllTitle,k=e.collapseAllTitle,p=e.enableRowClick,u=e.rowClickExcludedTags,f=e.enableCache,x=e.extraData,g=n?e.rowCssClass+" skip-export":e.rowCssClass,w=e.animationDuration,h=t("#"+a),m=h.find(".kv-expand-header-cell"),C=m.find(".kv-expand-header-icon"),R=void 0===e.collapseAll?!1:e.collapseAll,N=void 0===e.expandAll?!1:e.expandAll,A=h.find("td .kv-expand-row:not(.kv-state-disabled)"),b=A.length,T="kv-expand-detail-loading",y=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},E=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},D=function(e,t){e.removeClass(t).addClass(t)},I=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},F=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},L=function(e){D(e,T)},U=function(e){var t=isNaN(w)?1e3:w+200;setTimeout(function(){e.removeClass(T)},t)};return 0===x.length&&(x={}),0===A.length?void D(m,"kv-state-disabled"):(A.each(function(){var e,a,n=t(this),v=n.find(".kv-expand-icon"),k=n.closest("tr"),A=n.closest(".kv-expand-icon-cell"),D=n.find(".kv-expand-detail"),j=n.find(".kv-expanded-row"),K=j.data("key"),Q=j.data("index"),q=k.find("td:visible").length;if(!y(v)&&!E(v))return!0;0===j.length&&(K=k.data("key"),e=k.next('tr.kv-expand-detail-row[data-key="'+K+'"]'),j=e.find(".kv-expanded-row"));var z=function(e){var a=t.extend({expandRowKey:K,expandRowInd:Q},x),n=f?0===j.html().length:!0;return L(A),l.length>0&&n?(h.trigger("kvexprow.beforeLoad",[Q,K,x]),void j.load(l,a,function(){U(A),o&&t.isFunction(o)&&o(),e(),h.trigger("kvexprow.loaded",[Q,K,x])})):(U(A),void e())},B=function(e){h.find('tr[data-index="'+Q+'"]').remove(),j.hide(),k.after(j);var t='<tr class="kv-expand-detail-row '+g+'" data-key="'+K+'" data-index="'+Q+'">';j.wrap('<td colspan="'+q+'">').parent().wrap(t),v.html(s),A.attr("title",c),e?j.slideDown(w,function(){F(v)}):(j.show(),F(v)),0===l.length&&U(A)},G=function(){L(A),D.html(""),v.html(i),A.attr("title",r),a=j.closest(".kv-expand-detail-row"),j.slideUp(w,function(){j.unwrap().unwrap(),j.appendTo(D),I(v)}),U(A)},H=function(){return A.hasClass(T)?void 0:E(v)?(z(function(){B(!0)}),h.trigger("kvexprow.toggle",[Q,K,x,!0]),void v.focus()):void(y(v)&&(G(),h.trigger("kvexprow.toggle",[Q,K,x,!1]),v.focus()))};return N&&d?(E(v)&&z(function(){B(!0),kvRowNum++,kvRowNum>=b&&(U(m),C.focus())}),kvRowNum>=b&&(U(m),C.focus()),!0):R&&d?(y(v)&&(G(),kvRowNum++,kvRowNum>=b&&(U(m),C.focus())),kvRowNum>=b&&(U(m),C.focus()),!0):(y(v)&&B(!1),A.off("click").on("click",function(){H(A)}),void k.off("click").on("click",function(e){var a=e.target,n=t(a).length&&t(a).hasClass("kv-disable-click")||-1!==t.inArray(a.nodeName,u);p&&!n&&H(A)}))}),void(d&&m.off().on("click",function(){if(!m.hasClass(T)&&0!==A.length){var a=E(C),n=y(C),l=t.extend({},e,{expandAll:n,collapseAll:a});L(m),n?(kvRowNum=A.find(".kv-state-collapsed").length,I(C),C.html(s),m.attr("title",k),h.trigger("kvexprow.toggleAll",[x,!1])):a&&(kvRowNum=A.find(".kv-state-expanded").length,F(C),C.html(i),m.attr("title",v),h.trigger("kvexprow.toggleAll",[x,!0])),kvExpandRow(l)}})))}(window.jQuery)};